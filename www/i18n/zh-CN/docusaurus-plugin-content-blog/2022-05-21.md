---
slug: devtools-swacli-deploy
title: "#20: Deploy with SWA CLI"
authors: [wassim, yohan]
tags: [swa, 30days, dev-tools]
draft: false
---

<head>
  <meta name="twitter:url" content="https://www.azurestaticwebapps.dev/blog/devtools-swacli-deploy" />
  <meta name="twitter:title" content="#20: Deploy with SWA CLI" />
  <meta name="twitter:description" content="Join @sinedied and @manekinekko on #30DaysOfSWA in part 2 of the intro to SWA CLI for @AzureStaticApps - focused on deployment!" />
  <meta name="twitter:image" content="https://www.azurestaticwebapps.dev/assets/images/20-banner-62cb7a9019981d88c514d8875b8547d9.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:creator" content="@nitya" />
  <meta name="twitter:site" content="@AzureStaticApps" /> 
  <link rel="canonical" href="https://dev.to/azure/deploy-your-static-web-apps-to-azure-directly-from-the-command-line-2ip8" />
</head>

欢迎来到 **#30DaysOfSWA** 的 `第3周第6天`！！

这是2篇系列文章的第二部分，重点介绍在[Azure Static Web Apps周年活动](https://docs.microsoft.com/en-us/events/learntv/swa-anniversary-may-2022?WT.mc_id=30daysofswa-61155-cxall)上发布的[Azure Static Web Apps CLI](https://azure.github.io/static-web-apps-cli/?WT.mc_id=30daysofswa-61155-cxall)。昨天的文章介绍了核心的`swa`命令，并详细讲解了`swa init`和`swa start`命令及其配置。

今天，我们将探索`swa login`和`swa deploy`命令，它们可以帮助你将本地开发的应用程序部署到Azure云上。我们还将介绍如何使用环境变量来进一步简化开发体验。

:::info[我们将涵盖的内容]
 * 登录Azure
 * 部署你的应用
 * 环境变量
 * **练习**：使用新的`swa` CLI进行身份验证并部署你的应用
:::

![](../static/img/series/20-banner.png)

在这篇关于SWA CLI的第二篇文章中，我们将讨论新的部署选项。是的，你现在可以直接从命令行部署你的应用了！还有谁能比实现这个功能的人更适合来讲解呢？我将让我的朋友[Wassim](https://twitter.com/manekinekko)为你详细解释。

> 如果你从未听说过Static Web Apps（简称SWA），它是Azure提供的一项Web应用托管服务，提供了简化的全栈开发体验，内置了许多功能，如身份验证、可自定义的路由、无服务器函数等。它还有一个很棒的[免费层](https://azure.microsoft.com/free/?WT.mc_id=30daysofswa-61155-cxall) 😉

## 登录Azure

在新的Azure Static Web Apps CLI中，我们引入了一个新的`swa login`命令，允许你直接从命令行登录到你的Azure账户。此命令会加密并将你的凭据存储在你系统的密钥链中，这样你就不需要再次输入它们。

在大多数常见情况下，`swa login`会从以下位置（按此顺序）获取你当前活动的Azure凭据：

1. 你的环境变量，如果你设置了以下任意一个或多个[变量](https://azure.github.io/static-web-apps-cli/docs/cli/env-vars#azure-identity?WT.mc_id=30daysofswa-61155-cxall)：
    - `AZURE_TENANT_ID`
    - `AZURE_CLIENT_ID`
    - `AZURE_CLIENT_SECRET`
2. 你当前的Visual Studio Code，如果你正在使用VS Code并已连接到Azure。
3. 通过浏览器进行交互式提示。
4. 最后的回退是设备代码流，它将提示你使用生成的设备代码登录到你的Azure账户。

不过，如果需要，你也可以通过命令行提供这些凭据，使用可用的标志：

```bash
Usage: swa login [options]

login into Azure

Options:
  -S, --subscription-id <subscriptionId>    Azure subscription ID used by this project
                                            (default: "process.env.AZURE_SUBSCRIPTION_ID")
  -R, --resource-group <resourceGroupName>  Azure resource group used by this project
  -T, --tenant-id <tenantId>                Azure tenant ID (default: "process.env.AZURE_TENANT_ID")
  -C, --client-id <clientId>                Azure client ID
  -CS, --client-secret <clientSecret>       Azure client secret
  -n, --app-name <appName>                  Azure Static Web App application name
  -cc, --clear-credentials                  clear persisted credentials before login (default: false)
  -u, --use-keychain                        enable using the operating system native keychain
                                            for persistent credentials (default: true)
  -nu, --no-use-keychain                    disable using the operating system native keychain
```

登录后，SWA CLI会将你的活动Azure订阅ID和租户ID存储在你项目根目录下名为`.env`的本地文件中：

```bash
➜ swa login

Welcome to Azure Static Web Apps CLI (1.0.0)

Checking Azure session...
✔ Successfully logged into Azure!
✔ Saved project credentials in .env file.
✔ Successfully setup project!
```

这个文件将在使用`swa deploy`命令将你的项目部署到Azure时使用。

## 部署你的应用

新的SWA CLI使得将你的应用部署到Azure变得更加容易。你现在可以直接从命令行使用一个简单的`swa deploy`命令来部署你的应用。

`swa deploy` 命令足够智能，能够判断您是否已拥有可用的 Azure Static Web Apps 实例。若存在，则直接使用；否则会自动创建新实例，或提示您从现有实例列表中选择：

```bash
➜ swa deploy

Welcome to Azure Static Web Apps CLI (1.0.0)

Using configuration "thundr" from file:
  /home/wassimchegham/oss/@thundr-dev/thundr/swa-cli.config.json

Deploying front-end files from folder:
  /home/wassimchegham/oss/@thundr-dev/thundr/app/dist/thundr-ui

Deploying API from folder:
  /home/wassimchegham/oss/@thundr-dev/thundr/api

Checking Azure session...
✔ Successfully logged into Azure!

Checking project settings...
? Choose your Static Web App › - Use arrow-keys. Return to submit.
❯   >> Create a new application
    swa_samples/angular-web-bluetooth
    swa_samples/catsify
    swa_samples/hexa
    swa_samples/ngxtools
    swa_samples/nitrooo
  ↓ swa_samples/photobooth-teams

```

该命令还能检测现有 Static Web Apps 实例是否已通过 CI/CD 流水线部署，并给出相应提示！

## 通过 CI/CD 流水线部署

从 CI/CD 流水线部署是项目中的常见实践。您可通过设置部署令牌，使用 `swa deploy` 命令从 CI/CD 流水线将应用部署到 Azure：

```bash
➜ swa deploy --print-token --app-name thundr --resource-group swa_samples

Welcome to Azure Static Web Apps CLI (1.0.0)

Checking project "thundr" settings...
✔ Successfully setup project!

Deploying to environment: preview

Deployment token:
7c3fc44b858164b677-truncated-8c80ace9-39a8-416c-ae22-864745c0470b003
```

```bash
swa deploy --deployment-token=7c3fc44b858164b677-truncated-8c80ace9-39a8-416c-ae22-864745c0470b003b003
```

您也可将部署令牌设为[环境变量](https://azure.github.io/static-web-apps-cli/docs/cli/env-vars#deploy-settings?WT.mc_id=30daysofswa-61155-cxall)：

```bash
export SWA_CLI_DEPLOYMENT_TOKEN=7c3fc44b858164b677-truncated-8c80ace9-39a8-416c-ae22-864745c0470b003b003
swa deploy
```

## 环境变量

新版 SWA CLI 引入了一系列环境变量来简化配置体验。您可通过设置以下变量自定义 CLI 行为：

- 常规设置
- 模拟器设置
- 部署设置
- 运行时设置
- 登录体验

更多细节请参阅文档网站的[环境变量章节](https://azure.github.io/static-web-apps-cli/docs/cli/env-vars??WT.mc_id=30daysofswa-61155-cxall)。

## 后续步骤

从项目初始化到 Azure 部署，再到完整的本地测试环节，您现在已能通过命令行掌控整个开发流程。接下来真正的挑战是如何运营和扩展您的应用 😉。

如需获取开发技巧，可观看 [Static Web Apps 技巧与窍门](https://aka.ms/StaticWebAppsTips??WT.mc_id=30daysofswa-61155-cxall)视频系列。

您也可通过[新版文档网站](https://azure.github.io/static-web-apps-cli/?WT.mc_id=30daysofswa-61155-cxall)了解 SWA CLI 的所有新功能。

## 反馈通道

我们随时在 dev.to 上倾听并为您提供帮助！🙂

请分享您的使用体验、遇到的困难、疑问，以及希望在未来版本中看到的功能。

## 资源

想观看 Static Web Apps CLI 的实际演示？该工具已在昨日举办的 [Azure Static Web Apps 周年庆](https://aka.ms/swaanniversary)上正式发布，相关演示片段可供参考。

<iframe width="560" height="315" frameborder="0"  src="https://www.youtube.com/embed/1e6k5HNK4F8?WT.mc_id=30daysofswa-61155-cxall" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>