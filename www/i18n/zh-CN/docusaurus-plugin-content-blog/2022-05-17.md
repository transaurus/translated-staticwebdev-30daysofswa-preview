---
slug: devtools-playwright
title: "#16: Test Automation with Playwright"
authors: [nitya, debbie]
tags: [swa, 30days, dev-tools, playwright]
draft: false
---

欢迎来到 **#30DaysOfSWA** 的 `第3周第2天`！

昨天我们以讨论构建现代Web应用的端到端开发者体验开启了"开发者工具"主题周。今天我们将聚焦关键环节——**测试**。让我们探讨现代Web应用的测试自动化意味着什么，以及如何利用[Playwright](https://www.playwright.dev)实现Azure静态Web应用的端到端自动化测试。

## 今日要点

* 现代Web应用的测试自动化
 * 什么是Playwright？
 * Playwright快速入门
 * 探索Playwright工具链
 * 在SWA中使用Playwright
 * **实践**：用**你的**部署应用尝试教程

![](../static/img/series/16-banner.png)

## 测试自动化

现代移动Web应用需要确保在所有主流浏览器（如Chromium、Firefox或WebKit）及其运行的设备平台（不同屏幕尺寸和方向）上都能正确稳定运行。当我们考虑这些组合场景下的测试粒度时，**人工**测试UI/UX变得异常困难。若再考虑每次代码提交或拉取请求都需要验证的频率，人工测试更是不可能完成的任务。这正是测试自动化的价值所在！

测试自动化通过**自动**执行测试来验证软件规范，并利用报告反馈迭代提升软件质量。对于Web应用，这需要能_在浏览器中自动化测试操作_（Web自动化）且_跨浏览器保持一致性_的工具。[这正是Playwright的强项！](https://www.playwright.dev)

## Playwright概览

Playwright是用于现代Web应用**可靠**端到端测试的开源框架。其内置的[Playwright测试运行器](https://playwright.dev/docs/1.21/intro)可自动化测试执行，同时提供[Playwright库](https://playwright.dev/docs/1.21/library)简化与第三方方案的集成。

![Playwright可视化指南](../static/img/series/16-playwright.jpg)

该可视化指南展示了框架的核心特性（[下载高清版本](https://github.com/SketchTheDocs/cloud-skills/blob/main/gallery/Playwright-03-Overview.png)），包括：

* **统一API** - 一次编写测试，全平台运行
 * **移动Web测试** - 丰富的设备配置文件，支持原生模拟器
 * **多语言支持** - 可用Java、JS/TS、Python或C#编写测试
 * **可靠测试** - 自动等待机制和Web优先断言消除不稳定测试
 * **强大工具链** - 提供测试编写、调试、分析和报告支持
 * **完全隔离** - 毫秒级创建浏览器上下文，支持测试并行化

详见Playwright[文档](https://playwright.dev/docs/1.21/intro)和[API](https://playwright.dev/docs/1.21/api/class-playwright)。

**能用Playwright测试哪些内容？**

* 验证UI组件行为是否符合预期（事件）
 * 验证UI流程是否正确（导航、输入）
 * 测试不同上下文中的UX行为（使用fixtures）
 * 修改网络流量（认证、代理等）进行测试
 * 模拟网络条件下的行为验证
 * 验证设备上下文行为（模拟配置文件）
 * 自动化捕获测试证据（视频、截图）

参考**[指南](https://playwright.dev/docs/1.21/library)**和**[Demo.Playwright](https://github.com/MarcusFelling/Demo.Playwright#run-playwright-example-tests)**获取使用示例。另可查阅**[Debbie的playwright-testing](https://dev.to/debs_obrien/series/17445)**系列了解Playwright实战案例。

## Playwright 快速入门

现在让我们动手实践 Playwright。请参考官网的[入门指南](https://playwright.dev/docs/1.21/intro)。

我们将通过一个真实案例，演示如何从模板配置过渡到基础脚本编写，为测试 Azure 静态应用奠定基础。

**#30DaysOfSWA 网站示例：分步教程**：

查看我今日创建的[代码仓库](https://github.com/fearlessly-dev/30daysofSWA-testing)，该仓库基于快速入门指南为 [#30DaysOfSWA](https://aka.ms/30DaysOfSWA) 网站配置端到端测试！[README](https://github.com/fearlessly-dev/30daysofSWA-testing) 详细记录了以下步骤：

* [配置测试仓库](https://github.com/fearlessly-dev/30daysofSWA-testing#2-where-should-my-tests-be)
 * [安装 Playwright](https://github.com/fearlessly-dev/30daysofSWA-testing#3-how-do-i-install-playwright)
 * [探索模板配置](https://github.com/fearlessly-dev/30daysofSWA-testing#4-what-did-the-installation-do)
 * [运行默认测试](https://github.com/fearlessly-dev/30daysofSWA-testing#5-what-can-i-do-with-this)
 * [查看生成的测试报告](https://github.com/fearlessly-dev/30daysofSWA-testing#6-what-does-the-report-show)
 * [通过 GitHub Actions 自动化测试](https://github.com/fearlessly-dev/30daysofSWA-testing#7-what-about-those-github-actions)
 * [查看 Actions 生成的报告资产](https://github.com/fearlessly-dev/30daysofSWA-testing#8-viewing-actions-generated-reports)
 * [为*我的*应用定制默认脚本/配置](https://github.com/fearlessly-dev/30daysofSWA-testing/blob/main/README.md#9-lets-customize-the-script)
 * [追踪日志的妙用！！](https://github.com/fearlessly-dev/30daysofSWA-testing/blob/main/README.md#the-joys-of-trace-logs)
 * **大功告成！**

完成本教程后，你将获得：

* 为**你的**应用定制的初始测试脚本
 * 启用了追踪功能的测试配置文件，可捕获详细分析数据
 * 随代码变更自动运行测试的 GitHub Actions 工作流

![测试运行报告](https://github.com/fearlessly-dev/30daysofSWA-testing/raw/main/my-report-detail.png)

至此，你可以进一步：

* 在 `example.spec.js` 中添加更多测试 => 参考：[Playwright 测试 API](https://playwright.dev/docs/test-annotations)
 * 在 `playwright.config.js` 中配置测试运行 => 参考：[配置对象](https://playwright.dev/docs/test-configuration)

## Playwright 工具链

上述教程中我们简要提到了 Playwright 工具（CLI、TraceViewer、HTML 报告器、Codegen）。Playwright 提供了一套强大的工具链，可优化从_编写_到_报告_的端到端测试体验。

**首先熟悉 [Playwright CLI](https://playwright.dev/docs/cli)**。

这是所有命令行工具的主入口。通过 CLI 你可以：导航页面（_"open"_）、安装浏览器依赖（_"install"_）、截取屏幕（_"screenshot"_）、启动测试运行器（_"test"_）、编写测试（_"codegen"_）、查看追踪记录（_"show-trace"_）等。

按以下方式启动 CLI：

```
npx playwright <command> [options]
```

使用 `npx playwright --help` 查看已安装 CLI 版本支持的命令和选项详情。需要更深入探索？

* 阅读 Nitya 的 **[工具详解文章](https://dev.to/azure/005-tool-talk-hello-command-line-faj)** 获取详细解析
 * 下载这份 **[高清可视化指南](https://cloud-skills.dev/gallery/Playwright-01-CommandLine.png)** 作为速查表

**使用示例**:

让我们使用 `screenshot` 命令捕获 #30DaysOfSWA 网站启动帖子的截图，设备配置文件选择 "iPhone 6"。可参考当前支持的 [命名设备配置文件列表](https://github.com/microsoft/playwright/blob/f1307f4a4d92490d7d0e7ee5a6a7fe9a22804e86/packages/playwright-core/src/server/deviceDescriptorsSource.json)。

```
npx playwright screenshot --device "iPhone 6" https://www.azurestaticwebapps.dev/blog/kickoff 30Days.png

Navigating to https://www.azurestaticwebapps.dev/blog/kickoff
Capturing screenshot into 30Days.png
```

| **Result:** This is what the saved image looks like. |
|:--|
| ![Screenshot](../static/img/series/30Days.png) |

**然后开始探索这些工具**:

* [检查器](https://playwright.dev/docs/inspector) - 基于 GUI 的测试执行调试工具
 * [追踪查看器](https://playwright.dev/docs/trace-viewer) - 可视化查看测试追踪记录
 * [代码生成器](https://playwright.dev/docs/codegen) - 根据用户交互生成测试的创作工具
 * [调试工具](https://playwright.dev/docs/debug) - 支持运行时调试的附加工具
 * [报告器](https://playwright.dev/docs/test-reporters) - 多种内置报告格式

---

## 后续步骤

今天我们涵盖了大量内容。

至此，您应该了解 Playwright 是什么，以及为何它对现代 Web 应用的自动化测试如此有用。您应该对其强大的开发者工具有所认知，并掌握如何为 Azure Static Web App 配置它。同时您已获得构建测试套件的良好基础。

接下来如何提升技能？我们为您准备了：

* **[关注此仓库](https://github.com/fearlessly-dev/30daysofSWA-testing)** - 我将持续添加更多测试案例，通过已部署的 SWA 演示 Playwright 各项功能，并探索 SWA 特有特性和用法
 * **明日加入我们** - 探索"使用 Azure DevOps 实现多阶段部署"的完整演示，包含 Playwright 测试集成。学习如使用 SWA 环境变量定义测试参数等最佳实践
 * **最后但同样重要** - 观看去年 Azure Static Web Apps 团队关于 Playwright 端到端测试的深度分享：

    <iframe  width="560" height="315" frameborder="0"  src="https://aka.ms/docs/player?ev=learn-tv-static-web-apps-code-to-scale&session=end-to-end-testing-with-playwright"></iframe>

## 实践练习

选择您已构建（或正在使用）的任一应用（建议当前部署在 Azure Static Web Apps 上的应用，便于后续探索其他场景）。

按照 [相同步骤](https://github.com/fearlessly-dev/30daysofSWA-testing) 为 **您的** 已部署应用配置测试环境，然后尝试添加一个超越基础测试用例的新测试脚本。可参考 [演示项目](https://github.com/MarcusFelling/Demo.Playwright) 获取灵感！