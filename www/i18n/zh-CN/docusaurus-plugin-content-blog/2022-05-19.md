---
slug: devtools-msedge
title: "#18: Debug with Edge DevTools"
authors: [patrick]
tags: [swa, 30days, dev-tools]
draft: false
description: Learn to use Microsoft Edge DevTools and its VS Code Extension to debug you Azure Static Web App and improve performance and accessibility
image: "../static/img/series/18-banner.png"
keywords: [devtools, msedge, azure, staticwebapps, vscode]
---

<head>
  <meta name="twitter:url" content="https://www.azurestaticwebapps.dev/blog/devtools-msedge" />
  <meta name="twitter:title" content="#18: Debug with Edge DevTools" />
  <meta name="twitter:description" content="Join @patrickbrosset on #30DaysOfSWA to explore Debugging, Perf, #Accessibility for @AzureStaticApps using @MSEdgeDev #DevTools on @code" />
  <meta name="twitter:image" content="https://www.azurestaticwebapps.dev/assets/images/18-banner-3c83eb95b9d1aabe5f27d4282c5423ad.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:creator" content="@nitya" />
  <meta name="twitter:site" content="@AzureStaticApps" /> 
  <link rel="canonical" href="https://www.azurestaticwebapps.dev/blog/devtools-msedge" />
</head>

欢迎来到 **#30DaysOfSWA** 的 `第3周第4天`!!

:::info[全球无障碍意识日]
你知道吗？今天是[全球无障碍意识日](https://accessibility.day/)——一个让我们思考**数字无障碍性**的日子，探讨如何使网络体验对所有人更加包容和友好！

访问[Microsoft Edge无障碍功能文档](https://docs.microsoft.com/en-us/microsoft-edge/accessibility/)，了解设计、构建和测试现代网站无障碍性的最佳实践。
:::

正如我们将在本周晚些时候的一篇文章中了解到的（敬请期待！），使用[VS Code的Azure Static Web Apps扩展](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurestaticwebapps)可以快速从VS Code中创建和管理你的Web应用。  
_但开发者体验的其他方面呢——比如在浏览器中调试你的Web应用或分析其性能？_

**作为Web开发者，减少上下文切换非常重要。**

你工作中需要使用的工具越少越好。这样你可以更容易地专注于手头的任务，而不必频繁应对电脑上的多个工具和窗口。当你依赖的工具能更好地协同工作时，你的工作效率会更高。

## 我们将涵盖的内容

* 开始使用**Edge DevTools** VS Code扩展
* 为你的前端应用提供无缝的**调试**体验
* 探索DevTools中的一些**无障碍**工具
* 探索DevTools中的一些**性能优化**工具
* **练习：**安装Edge DevTools VS Code扩展并尝试这些功能！

![](../static/img/series/18-banner.png)

## 在VS Code中调试前端代码

当你创建了SWA并开始为其添加更多功能后，调试前端代码可能会变得很有必要。也许你添加了一些需要调试的JavaScript前端逻辑，或者新的CSS布局代码需要检查。

这时，你最喜欢的浏览器内置的DevTools会非常有用。但是，为了进行调试而不得不在编辑器中的源文件和浏览器窗口之间来回切换，很快就会让人感到沮丧。这也容易出错，因为目前没有很好的解决方案能将你在DevTools中所做的调整直接同步回编辑器。

一个能提供很大帮助的工具是**[VS Code的Microsoft Edge开发者工具扩展](https://marketplace.visualstudio.com/items?itemName=ms-edgedevtools.vscode-edge-devtools)**。这个扩展让你直接在VS Code中使用DevTools。

:::info[Edge DevTools for Visual Studio Code v2 刚刚发布！]
[**阅读这篇文章**](https://dev.to/codepo8/edge-devtools-for-visual-studio-code-v2-1bp3)，了解改进和新功能，如_支持模拟的屏幕投射_、_样式的源映射支持_等！
:::

通过这个扩展，**元素**和**网络**工具直接嵌入到VS Code中，你的**控制台**消息会显示在VS Code的控制台中，Edge**问题**面板检测到的问题会直接在你的源代码中高亮显示，并且你可以在VS Code中实时预览你的Web应用前端！

最后，当你在**样式**面板中调整CSS代码时，你的更改会自动应用到源文件中，即使你使用的是CSS预处理器。

<!-- Insert Chris' video here -->

### 开始使用Edge DevTools VS Code扩展

首先，让我们直接从VS Code安装这个扩展。

1. 在 VS Code 中，打开 **扩展** 侧边栏，搜索 "Edge Tools"。
1. **Microsoft Edge Tools for VS Code** 扩展应出现在列表中。点击 **安装** 按钮并等待安装完成。

![VS Code 截图显示扩展侧边栏，其中列出了 Edge Tools for VS Code 扩展](../static/img/series/w3d4/install.png)

安装完成后，扩展会以新图标形式出现在 **活动栏** 中，提供实用功能入口。让我们直接体验最实用的功能：为项目生成 `launch.json` 配置文件。

1. 点击 **活动栏** 中的 **Microsoft Edge Tools** 扩展图标。
1. 点击 **Generate launch.json**。VS Code 中将出现包含可调整配置详情的文件。

![VS Code 截图显示 Edge Tools 侧边栏，包含生成 launch json 文件的按钮及生成的文件](../static/img/series/w3d4/launchjson.png)

现在最需要调整的配置是 `url`，如果需要还可以添加 `preLaunchTask`。

我将以个人博客项目为例说明修改方式。该项目配置了构建任务：从 markdown 生成博客 HTML 代码，监听文件变更，并通过 HTTP 8080 端口提供站点服务。

因此，我将把 `launch.json` 中的 **Launch Microsoft Edge in headless mode** 配置修改为：

```json
{
  "type": "pwa-msedge",
  "name": "Launch Microsoft Edge in headless mode",
  "request": "launch",
  "runtimeArgs": [
    "--headless",
    "--remote-debugging-port=9222"
  ],
  "preLaunchTask": "npm: serve",
  "url": "http://localhost:8080",
  "presentation": {
    "hidden": true
  }
}
```

使用此启动配置时，系统将从源代码构建博客，在本地服务器运行，直接在 VS Code 中打开浏览器，并同步显示 DevTools 面板。点击 **Microsoft Edge Tools** 扩展中的 **Launch Project** 即可启动全流程。

![VS Code 截图显示并排的三个面板：CSS 文件、DevTools 和站点渲染效果](../static/img/series/w3d4/firstrun.png)

现在请根据您的项目需求调整配置。接下来我们将介绍扩展的核心功能。

### 将 CSS 修改同步至源文件

在 DevTools 中调整 CSS 属性的优势在于可以实时预览网页效果，而 **Microsoft Edge Tools** 扩展还能将修改直接映射回源文件。这样您无需手动记忆并应用所有修改，扩展会自动建立实时 CSS 代码与项目源文件的映射关系。

在 **Styles** 面板修改 CSS 代码会自动打开对应源文件并应用相同变更。

注意扩展不会自动保存 CSS 源文件。您可以在 DevTools 中持续调整 CSS，仅当确认修改后，扩展才会代您保存源文件变更。

更多 CSS 镜像功能说明请参阅 [Microsoft Edge DevTools 扩展文档](https://docs.microsoft.com/microsoft-edge/visual-studio-code/microsoft-edge-devtools-extension#syncing-live-changes-from-the-styles-tool-by-using-css-mirror-editing)。

![VS Code 截图显示在 DevTools 面板编辑 CSS 值时，源文件中的对应值同步更新](../static/img/series/w3d4/mirror.png)

### 检测代码问题

Edge DevTools 内置的 **Issues** 工具可提供被检测网页的实用信息，例如浏览器兼容性、可访问性或安全问题报告。

VS Code 中的 **Microsoft Edge Tools** 扩展提供相同功能，但直接集成在源代码中。例如，CSS 源文件中的浏览器兼容性警告会以波浪线高亮显示，悬停提示框会展示问题详情。

![VS Code编辑器中CSS文件部分截图，显示某CSS属性被下划线标记，工具提示说明该属性存在浏览器兼容性警告](../static/img/series/w3d4/cssissue.png)

您也可以通过打开VS Code底部面板中的**问题(Problems)**视图一次性查看所有问题。

更多代码问题检测方法请参阅[Microsoft Edge DevTools扩展文档](https://docs.microsoft.com/microsoft-edge/visual-studio-code/microsoft-edge-devtools-extension#inline-and-live-issue-analysis)。

### 获取控制台消息

VS Code中的**Microsoft Edge工具**扩展还集成了广受欢迎的**控制台(Console)**工具。开发者在调试代码时经常依赖控制台输出。

由于该扩展可与VS Code内置JavaScript调试器协同工作，这意味着您可以在VS Code中正常调试前端JavaScript代码，同时直接在相邻的DevTools面板查看控制台日志。

## 了解其他DevTools功能

正如我们所见，**Microsoft Edge工具**扩展非常实用。它满足了大多数Web开发工具需求，同时确保您无需离开VS Code即可获得无缝体验。

但浏览器版Edge DevTools（按**F12**调出的工具）中仍有部分功能尚未集成到VS Code扩展版本。

构建优秀的静态Web应用(SWA)首先需要构建优秀的Web应用。虽然掌握SWA的细节非常重要，但学习如何为所有用户打造高性能、无障碍的Web体验同样关键。

下面我们来了解几个能助您实现这一目标的DevTools功能。

### 修复无障碍访问问题

每年[WebAIM组织](https://webaim.org/)都会发布关于造成用户无障碍访问障碍的最常见网站问题报告。遗憾的是，结果总令人忧心。您可阅读[2022年WebAIM百万网站调查报告](https://webaim.org/projects/million/)。

但好消息是，最常见的无障碍问题都可以通过DevTools轻松检测和解决！让我们了解几个有助于创建普惠性Web体验的功能。

最普遍的无障碍问题是文本对比度不足。如果文本颜色与背景色的对比比率过低，用户可能完全无法阅读内容。DevTools中的取色器是检测此类问题的利器。

1. 在网页文本上右键点击并选择**检查(Inspect)**
1. 在**样式(Styles)**标签页找到定义文本颜色的**color**CSS属性，点击其旁边的色块
1. 查看取色器中的**对比度比率(Contrast ratio)**。理想状态应显示两个对勾标记，表示符合推荐标准

![Edge浏览器Elements工具截图，显示Styles面板中文本颜色CSS属性的取色器及对比度比率报告](../static/img/series/w3d4/colorpicker.png)

若文本对比度不足，您可以直接在DevTools中修复。

1. 点击**颜色对比度(Color contrast)**值旁的**显示更多(show more)**箭头展开详细信息，取色器中将出现两条参考线
1. 沿着这两条参考线选择符合推荐标准的颜色

![动态演示Styles面板中的取色器，展示两条用于选择达标颜色的参考线。移动当前颜色选择点时，对比度比率会实时重新计算](../static/img/series/w3d4/contrastratiolines.gif)

另一个非常常见的无障碍问题是图像缺少替代文本（alt text）。替代文本能帮助屏幕阅读器用户感知图像内容，同时也对用户禁用图片、图片加载失败的情况至关重要，甚至影响搜索引擎优化。而DevTools可以自动检测缺失的替代文本！因此没有任何理由不为图像编写优质的文本替代。

1. 按**F12**打开DevTools。
1. 点击顶部主工具栏中的**更多工具**(**+**)，从列表中选择**问题**工具。
1. 检查问题列表中是否包含**无障碍**类别。若有，请查看**图像必须具有替代文本**警告。
1. 打开任意警告查看问题详情，点击**在元素面板中打开**即可在**元素**工具中直接定位问题。

![Edge浏览器问题工具截图，显示4条缺失替代文本的警告](../static/img/series/w3d4/alttext.png)

现在我们来讨论源代码顺序问题。辅助技术（如屏幕阅读器）浏览页面的顺序与元素在文档源代码中的出现顺序直接相关。但视觉呈现顺序可能通过CSS调整而与源代码顺序完全不同。为确保文档导航逻辑对所有用户（包括辅助技术用户）都具有可理解性，必须检查源代码顺序是否合理。

Edge和Chrome DevTools提供的**源代码顺序查看器**功能可有效解决这个问题。

1. 按**F12**打开DevTools。
1. 在**元素**工具中选择需要检查的布局元素。
1. 点击侧边栏中的**无障碍**选项。
1. 在**无障碍**面板底部勾选**显示源代码顺序**复选框，页面将出现带数字编号的叠加层。
1. 通过在DOM树中选择不同元素持续检查其源代码顺序。

![Edge元素工具的无障碍面板截图，显示启用的源代码顺序查看器复选框及页面上的数字叠加层](../static/img/series/w3d4/sourceorder.png)

![Screenshot of the Accessibility pane in the Elements tool in Edge, with the source order viewer checkbox selected, and the numbers overlay displayed on the page.](../static/img/series/w3d4/sourceorder.png)

### 提升性能

优秀的性能表现能为网站带来显著积极影响。快速加载且即时响应操作的页面能有效提升用户留存率、参与度甚至商业收益。

虽然性能优化工作可能令人望而生畏，但DevTools中的**性能**工具和**分离元素**工具能大幅降低优化难度。

所有浏览器DevTools（Edge、Chrome、Firefox或Safari）都内置**性能**工具。这些工具核心功能相似，均可分析指定时间段内被检测网页的运行性能表现。

在Edge中使用该工具：

1. 按**F12**打开DevTools。
1. 点击顶部主工具栏中的**性能**标签（若不可见需先点击**更多标签**(**>>**)按钮）。
1. 点击**录制**按钮。
1. 模拟正常用户操作使用网页。
1. 点击**停止**按钮结束录制。

![Edge DevTools性能工具界面截图](../static/img/series/w3d4/perftool.png)

**性能**工具能显示录制期间浏览器执行JavaScript代码、响应用户事件和页面重绘等操作的繁忙程度，是发现网站性能瓶颈的利器，可帮助您确定最具性价比的优化方案。

例如对于包含大量动画等视觉效果的站点，该工具可报告帧率(FPS)并在帧率过低可能影响用户体验时发出警报。

**性能工具**在紧凑的用户界面中集成了大量功能，因此查阅其文档以理解各项功能至关重要。了解更多信息，请参阅[运行时性能分析入门指南](https://docs.microsoft.com/microsoft-edge/devtools-guide-chromium/evaluate-performance/)。

另一个关键性能指标是内存占用。您的站点对可用内存的消耗量，以及是否随时间推移持续增加内存使用，可能导致站点甚至整个计算机运行缓慢。

DOM泄漏是一种常见的内存泄漏类型，当前端JavaScript代码进行大量DOM节点操作时，可能无意中保留了对不再需要的DOM节点的引用。随着应用或站点复杂度提升，开发者更容易因疏忽而引入此类内存泄漏。

Edge浏览器内置的**分离元素工具**专门用于排查此类内存泄漏。虽然发现泄漏存在并不困难，但定位泄漏源头往往如同黑暗中捉迷藏。该工具能列出仍驻留内存但未在页面使用的DOM节点，并显示代码中保持引用的具体位置，帮助您判断是否需要销毁这些节点以释放内存、提升性能。

在Edge中使用该工具的方法：

1. 按**F12**打开开发者工具
1. 点击顶部主工具栏的**更多工具**(**+**)，从列表中选择**分离元素工具**
1. 点击**获取分离元素**按钮列出内存中未使用的DOM节点
1. 模拟用户操作使用应用时，可重复点击该按钮更新列表。点击**垃圾回收**按钮可强制浏览器执行垃圾回收机制，观察节点是否被清除。

![Edge分离元素工具截图，显示列表中3个DOM节点](../static/img/series/w3d4/detachedelements.png)

该工具已提供初步排查方向，但其与**内存工具**深度集成，结合使用能更精准定位DOM节点的引用来源。

1. 点击**分析**按钮等待堆快照生成
1. 点击**ID**列中任意数字，即可从**分离元素工具**跳转至**内存工具**查看该DOM节点的持有者列表

**内存工具**的**持有者**区域将显示哪些代码段当前仍保持该DOM节点存活于内存中。

![Edge工具组合截图：上方分离元素工具，下方内存工具显示某个DOM节点的持有者列表](../static/img/series/w3d4/detachedelements-memory.png)

深入了解**分离元素工具**的使用方法，请参阅[使用分离元素工具调试DOM内存泄漏](https://docs.microsoft.com/microsoft-edge/devtools-guide-chromium/memory-problems/dom-leaks)。

## 总结

希望今天的分享对您有所启发。最核心的要点是：构建出色的Azure静态Web应用，始于为所有用户打造卓越的Web体验！

掌握这些诊断和修复常见问题的工具至关重要，而Edge开发者工具VS Code扩展通过直接集成到开发环境，能显著提升工作效率。

## 练习

安装最新版本的 **[Microsoft Edge 开发者工具 VS Code 扩展](https://marketplace.visualstudio.com/items?itemName=ms-edgedevtools.vscode-edge-devtools)**，并尝试使用这些功能。**尝试识别并修复无障碍访问问题**，或使用**性能工具**分析已部署静态 Web 应用的运行时性能。