---
slug: practices-byo-functions
title: "#26: Azure Functions & SWA"
authors: [craig]
tags: [swa, 30days, best-practices]
draft: false
---

<head>
  <meta name="twitter:url" content="https://www.azurestaticwebapps.dev/blog/practices-byo-functions" />
  <meta name="twitter:title" content="#24: Custom Vision & SWA" />
  <meta name="twitter:description" content="Join @CraigShoemaker on #30DaysOfSWA as he walks us through the what-why-how, of 'Bringing Your Own Functions' to @AzureStatic Apps!" />
  <meta name="twitter:image" content="https://www.azurestaticwebapps.dev/assets/images/26-banner.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:creator" content="@nitya" />
  <meta name="twitter:site" content="@AzureStaticApps" /> 
  <link rel="canonical" href="https://www.azurestaticwebapps.dev/blog/practices-byo-functions" />
</head>

欢迎来到 **#30DaysOfSWA** 的 `第4周第5天`！

本周我们将探索端到端的开发工作流，其中Azure静态Web应用作为集成组件，与其他服务协同提供增强的现代化Web应用体验。

默认的Azure静态Web应用架构将Web应用分为两个组件：静态资源（由全球内容分发服务提供）和动态API端点（通过无服务器架构实现）。在[启用SWA API](blog/deploying-swa)一文中，我们重点介绍了**托管函数**——即由Azure静态Web应用服务配置和管理您的Azure函数部署。

今天，我们将探讨另一种选择**自带函数(BYOF)**——您可以使用预先存在（或独立开发）的Azure函数应用，并独立管理其部署。

## 内容概览

* 什么是"自带函数(BYOF)"？
* BYOF相比托管函数的优势
* 从托管函数切换到BYOF
* **资源**：使用Azure函数构建无服务器应用
* **练习**：完成[此学习模块](https://docs.microsoft.com/en-us/learn/modules/automatic-update-of-a-webapp-using-azure-functions-and-signalr/)，为您的SWA添加实时更新功能！

![](../static/img/series/26-banner.png)

## "自带函数(BYOF)"意味着什么？

在[启用SWA API](blog/deploying-swa)一文中我们提到，Azure静态Web应用可以通过两种方式实现无服务器API：

* **托管函数**——由Azure静态Web应用服务配置和管理您的Azure函数部署
* **自带函数**——使用预先存在的Azure函数应用并自行管理部署

第二种方案意味着您可以构建并部署一个独立于静态Web应用的Azure函数无服务器应用。这些应用能够利用[完整的Azure函数功能集](https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview)，而不受SWA中托管函数的限制。您只需**配置**静态Web应用服务使用这个新的无服务器API端点。

## 为什么选择"自带函数"？

自带函数是Azure静态Web应用的一项强大功能，允许您链接现有函数应用并**规避托管函数的限制**。这意味着您可以：

* 使用[自定义处理程序](https://docs.microsoft.com/azure/azure-functions/functions-custom-handlers)以任意语言实现函数
* 通过[触发器和绑定](https://docs.microsoft.com/azure/azure-functions/functions-triggers-bindings?tabs=csharp)轻松创建复杂工作流
* 实现保持无服务器上下文状态性的[持久函数](https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-overview?tabs=csharp)
* 使用其他任何Azure函数特性并采用[最佳实践](https://docs.microsoft.com/en-us/azure/azure-functions/functions-best-practices?tabs=csharp)

这些能力在部署实际生产级应用时至关重要。请注意Azure静态Web应用有两种托管计划：免费版和标准版，其中免费版仅支持托管函数。要使用"自带函数"的强大功能，您需要选择标准计划。

## 链接现有函数应用

在静态Web应用中使用现有函数应用非常简单——**只需将两个应用链接起来**。建立链接后，原本发布在这个URL下的函数应用：

```
https://my-functions-app.azurewebsites.net/api/data
```

...现在也可以通过静态Web应用的`api`路由访问。

例如：

```
https://red-sea-123.azurestaticapps.net/api/data
```

关联现有Functions应用分为两步：(1) 更新[staticwebapp.config.json](https://docs.microsoft.com/azure/static-web-apps/configuration)文件，(2) 通过Azure门户关联应用。

### 1. 更新配置文件

编辑站点的`staticwebapp.config.json`文件进行以下修改：

* 将`api_location`值设为空字符串(`""`)

### 2. 通过Azure门户关联应用

在Azure门户中导航至静态Web应用并进行以下操作：

* 在*设置*菜单中点击**Functions**
* 在*环境*下拉菜单中选择**生产环境**
* 在*Functions类型*下拉菜单旁点击**关联Function应用**
* 从*订阅*下拉菜单中选择您的订阅
* 从*Function应用*下拉菜单中选择目标Functions应用名称
* 点击**关联**按钮

现在您的Functions应用已与网站关联，可通过静态Web应用的`api`路由访问！

## 资源

### 1. 概述

是否初次接触无服务器应用和Functions后端？观看这段[Azure Functions视频概述](https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview)，然后查阅[开发指南](https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference?tabs=blob)。

<iframe width="640" height="360" src="https://www.youtube.com/embed/8-jz5f_JyEQ" title="YouTube video player" frameborder="0" allowfullscreen></iframe>

### 2. 快速入门

想要快速上手Azure Functions？您可以使用C#、Java、JavaScript、PowerShell、Python、TypeScript等多种语言（如Go、Rust）编写函数。例如，可通过以下方式创建JavaScript Functions应用：

* [使用Visual Studio Code](https://docs.microsoft.com/en-us/azure/azure-functions/create-first-function-vs-code-node)
* [使用命令行工具](https://docs.microsoft.com/en-us/azure/azure-functions/create-first-function-cli-node?tabs=azure-cli%2Cbrowser)
* [使用ARM模板](https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-first-function-resource-manager?tabs=visual-studio-code%2Cazure-cli) = JSON配置文件

### 3. 学习路径

想要系统学习Azure Functions功能特性并通过实践模块掌握？尝试[创建无服务器应用程序](https://docs.microsoft.com/en-us/learn/paths/create-serverless-applications/)学习路径。该路径包含11个模块，涵盖核心概念和使用示例。

## 练习

完成[此学习模块](https://docs.microsoft.com/en-us/learn/modules/automatic-update-of-a-webapp-using-azure-functions-and-signalr/)，掌握如何使用Azure SignalR通过Azure Functions实现应用实时更新功能。_然后将所学知识应用于现有SWA项目的升级改造_。