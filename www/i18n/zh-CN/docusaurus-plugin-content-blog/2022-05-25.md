---
slug: practices-cognitive-services
title: "#24: Cognitive Services & SWA"
authors: [yönet]
tags: [swa, 30days, best-practices, AI, ComputerVision, CognitiveServices]
draft: false
---

<head>
  <meta name="twitter:url" content="https://www.azurestaticwebapps.dev/blog/practices-cognitive-services" />
  <meta name="twitter:title" content="#24: Custom Vision & SWA" />
  <meta name="twitter:description" content="Join @AysSomething as we kick off 'Best Practices' week on #30DaysOfSWA with a discussion on adding AI capabilities to @AzureStatic Apps using Cognitive Services!" />
  <meta name="twitter:image" content="https://www.azurestaticwebapps.dev/assets/images/24-banner.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:creator" content="@nitya" />
  <meta name="twitter:site" content="@AzureStaticApps" /> 
  <link rel="canonical" href="https://www.azurestaticwebapps.dev/blog/practices-cognitive-services" />
</head>

欢迎来到 **#30DaysOfSWA** 的第4周第3天！

我们继续"最佳实践周"的探索，今天将了解如何为Azure静态Web应用集成另一项Azure服务。昨天我们讨论了使用预训练Azure AI模型为网站添加搜索功能，今天我们将探讨如何运用视觉AI服务。

## 内容概览

-   Azure视觉服务概述
-   如何开始构建AI应用
-   如何使用JavaScript AI SDK
-   如何使用表单识别器分析文档
-   如何部署API和静态Web应用(SWA)
-   **实践** [构建并部署用于图像分析的SWA](https://docs.microsoft.com/samples/azure-samples/js-e2e-client-cognitive-services/build-and-deploy-a-static-web-app-to-azure/?WT.mc_id=javascript-68057-ayyonet)

## 相关资源

* [Azure自定义视觉](https://aka.ms/AzureCustomVision) - 文档
* [Azure AI基础：探索计算机视觉](https://docs.microsoft.com/en-us/learn/paths/explore-computer-vision-microsoft-azure/?WT.mc_id=javascript-68057-ayyonet) - 学习模块
* [SWA Next.js部署](https://docs.microsoft.com/azure/static-web-apps/deploy-nextjs?WT.mc_id=javascript-68057-ayyonet) - 文档

![](../static/img/series/24-banner.png)

## 什么是Azure视觉服务？

Azure AI视觉是[Azure认知服务](https://docs.microsoft.com/azure/cognitive-services/what-are-cognitive-services?WT.mc_id=javascript-57623-ayyonet)的组成部分——这些基于云的AI服务能赋予您终结者般的能力。

![](https://media.giphy.com/media/NHUaA15Nk910hFczxu/giphy.gif)

您可以拍摄照片并[通过图像分析描述内容、检测物体、地标和名人](https://docs.microsoft.com/azure/cognitive-services/computer-vision/quickstarts-sdk/image-analysis-client-library?tabs=visual-studio&pivots=programming-language-javascript&WT.mc_id=javascript-57623-ayyonet)，或[识别用户](https://docs.microsoft.com/azure/cognitive-services/face/build-enrollment-app?tabs=android&WT.mc_id=javascript-57623-ayyonet)，[读取文档](https://docs.microsoft.com/azure/cognitive-services/computer-vision/quickstarts-sdk/client-library?tabs=visual-studio&pivots=programming-language-javascript&WT.mc_id=javascript-57623-ayyonet)，以及扫描身份证或名片信息。所有这些超能力都只需通过API调用即可实现——使用Azure认知和应用AI服务。让我们深入探索可构建的内容和可定制的功能。

## 开始构建AI应用

如果您计划为应用程序注入AI能力，首先需要了解的是我们的[应用AI服务](https://docs.microsoft.com/azure/applied-ai-services/?WT.mc_id=javascript-57623-ayyonet)。这些服务基于认知服务构建，解决了最常见的用例。在视觉相关服务方面，我们提供两项应用AI服务：[表单识别器](https://docs.microsoft.com/azure/applied-ai-services/form-recognizer/?WT.mc_id=javascript-57623-ayyonet)和[视频分析器](https://docs.microsoft.com/azure/azure-video-analyzer/?WT.mc_id=javascript-57623-ayyonet)。

Azure 表单识别器基于 [光学字符识别(OCR)](https://docs.microsoft.com/azure/cognitive-services/computer-vision/overview-ocr?WT.mc_id=javascript-57623-ayyonet)、[文本分析](https://docs.microsoft.com/azure/cognitive-services/language-service/overview?WT.mc_id=javascript-57623-ayyonet) 和 [自定义文本](https://docs.microsoft.com/azure/cognitive-services/language-service/custom-text-classification/overview?WT.mc_id=javascript-57623-ayyonet) 等 Azure 认知服务构建，并针对疫苗接种卡、护照和税务文件等场景提供了 [定制训练模型](https://docs.microsoft.com/azure/applied-ai-services/form-recognizer/concept-custom?WT.mc_id=javascript-57623-ayyonet)。若您好奇为何需要表单识别器，可以尝试通过认知服务逆向实现其部分功能。

![从零造轮子而非使用现成解决方案](https://media.giphy.com/media/tH2Ur5u1wpfPDNHhgm/giphy.gif)

我不建议任何人这样做，因此您的首要步骤应是查阅 [应用AI服务文档](https://docs.microsoft.com/azure/applied-ai-services/?WT.mc_id=javascript-57623-ayyonet)，确认是否有现成服务能解决您的问题。当现有方案无法满足需求时，您可以使用认知服务中的 [计算机视觉](https://docs.microsoft.com/azure/cognitive-services/computer-vision/overview-image-analysis?WT.mc_id=javascript-57623-ayyonet)、[自定义视觉](https://docs.microsoft.com/azure/cognitive-services/custom-vision-service/?WT.mc_id=javascript-57623-ayyonet) 或 [人脸](https://docs.microsoft.com/azure/cognitive-services/face/overview?WT.mc_id=javascript-57623-ayyonet) API 进行构建。

探索这些API的理想起点是 [Vision Studio预览版](https://preview.vision.azure.com/) 或 [表单识别器Studio预览版](https://formrecognizer.appliedai.azure.com/studio)。例如，我曾测试能否通过计算机视觉识别混合现实设备。由于这类设备非常新颖且非常见物体，通用物体检测模型无法识别。在开发应用前，我通过Studio轻松发现需要训练定制模型。您可在此验证企业logo或产品是否易识别，或直接获取Studio内的代码示例开始无代码定制模型训练。

若目标物体未被识别，可通过 [customvision.ai](https://customvision.ai) 训练定制模型并部署。您将获得专属API端点，客户端调用方式与其他服务无异。训练定制模型时需注意：最关键的是需要多样化场景的图片样本。例如要寻找"威利"，仅用其肖像训练是不够的，还需包含人群中的场景图片。

您可阅读我如何训练定制模型并通过 [Power Apps AI Builder](https://docs.microsoft.com/ai-builder/overview?WT.mc_id=javascript-57623-ayyonet) 构建 [无代码AI原型](https://medium.com/microsoftazure/no-code-ai-app-with-azure-cognitive-services-custom-vision-and-power-apps-ca47c019dcd0)。

## 如何使用JavaScript AI SDK

使用这些API分析图像（非视频）时，基本流程大致相同：

-   登录您的 Azure 账户或[注册获取 200 美元免费额度](https://azure.microsoft.com/free/?WT.mc_id=javascript-57623-ayyonet)。
-   [创建 Azure 认知服务或特定服务资源](https://docs.microsoft.com/en-us/azure/cognitive-services/cognitive-services-apis-create-account?WT.mc_id=javascript-57623-ayyonet)并获取密钥与终结点信息。
-   安装相关服务的 [JavaScript SDK](https://www.npmjs.com/~azure-sdk) 和 [Azure Identity SDK](https://www.npmjs.com/package/@azure/identity)。
-   拍摄或上传一张图片。
-   使用资源密钥初始化 AzureCredentials 对象。
-   使用 Azure 凭据对象和终结点初始化客户端对象。
-   调用客户端的 analyze 方法发起 API 请求，等待响应。

类和方法名称会有所不同，例如表单识别器使用 `DocumentAnalysisClient`，自定义视觉使用 `PredictionAPIClient`，而人脸识别则使用 `FaceClient`。如果您正在训练自定义模型或使用表单识别器的特定模型，虽然需要执行一些额外操作，但最重要的部分已由我们的 SDK 功能实现。

## 如何使用表单识别器分析文档

让我们通过[新版 JavaScript SDK](https://www.npmjs.com/package/@azure/ai-form-recognizer/v/4.0.0-beta.3) 来演示表单识别器的代码实现。您可以从[静态 Web 应用模板库](https://github.com/staticwebdev)中选择模板，或将代码集成到现有应用中。

我们需要导入 SDK 对象和环境变量：

```javascript
import {
	AzureKeyCredential,
	DocumentAnalysisClient,
	DocumentField,
	FormRecognizerApiVersion,
	PrebuiltModels,
} from "@azure/ai-form-recognizer";

const key = process.env.FORM_RECOGNIZER_KEY || "";
const endpoint = process.env.FORM_RECOGNIZER_ENDPOINT || "";
```

在启动分析的异步回调函数中（如图片上传或点击事件回调），您需要初始化客户端对象并通过轮询获取完整分析结果。

```javascript
async function Analyze() {
	const client = new DocumentAnalysisClient(endpoint, new AzureKeyCredential(key));

	const poller = await client.beginAnalyzeDocument("prebuilt-document", formUrl);

	const { keyValuePairs, entities } = await poller.pollUntilDone();

	//Do amazing things with the data.
}
```

对结果进行处理——既可以使用身份证数据让用户登录，也可以向用户展示键值对信息。

## 将应用部署至静态 Web 应用

如果使用静态 Web 应用模板，只需推送代码即可向全球发布。

若未使用模板，可通过 [Azure 静态 Web 应用 VS Code 扩展](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurestaticwebapps)或 [SWA CLI](https://github.com/Azure/static-web-apps-cli) [将应用部署到](https://docs.microsoft.com/azure/static-web-apps/deploy-nextjs?WT.mc_id=javascript-57623-ayyonet) SWA 资源。

如需批量处理大量图片，或对图片执行多重操作（如检测物体、识别图中文字并翻译），建议使用 [Azure 函数应用](https://docs.microsoft.com/azure/azure-functions/?WT.mc_id=javascript-57623-ayyonet)。幸运的是，[为静态 Web 应用创建 API](https://docs.microsoft.com/azure/static-web-apps/functions-bring-your-own?WT.mc_id=javascript-57623-ayyonet) 正是 VSCode 扩展的功能之一。观看我的视频获取分步部署指南。

[![如何为 Azure 静态 Web 应用添加 API | Azure 技巧与窍门：静态 Web 应用](https://img.youtube.com/vi/VzML-6DClVU/0.jpg)](https://youtu.be/VzML-6DClVU)

希望这些内容能激发您使用 Azure 应用 AI 或认知服务增强应用程序。查看 [Build AI 演讲](https://aka.ms/MSBuild2022)和[演示项目](https://github.com/Azure-Samples/papiro)，探索更多 AI 应用场景。

[![MS Build 2022 AI 环节演示](https://media.giphy.com/media/YSsOvebCkyeglsqsaQ/giphy.gif)](https://youtu.be/L10-LnbXxEo)

[欢迎在Twitter上联系我](https://twitter.com/AysSomething)，如果您有任何疑问、想分享构建成果或讨论创意。

## 练习

想要探索Azure认知服务与Azure静态Web应用的集成？请尝试通过以下教程之一进行实践开发：

* [构建并部署用于图像分析的静态Web应用](https://docs.microsoft.com/samples/azure-samples/js-e2e-client-cognitive-services/build-and-deploy-a-static-web-app-to-azure/?WT.mc_id=javascript-68057-ayyonet) - 使用Azure认知服务（计算机视觉）构建一个React应用程序来分析图像，并将其部署到Azure静态Web应用。
 * [使用自定义视觉进行机器学习](http://aka.ms/ws-customvision) - 完成本实验课程，学习如何通过自定义视觉API构建检测狗品种的模型，然后将其部署到带有Azure Functions后端的Azure静态Web应用。